function e(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}var t=globalThis,r={},s={},n=t.parcelRequire49ed;null==n&&((n=function(e){if(e in r)return r[e].exports;if(e in s){var t=s[e];delete s[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){s[e]=t},t.parcelRequire49ed=n);var a=n.register;a("dFw4U",function(t,r){e(t.exports,"createRoot",()=>s,e=>s=e);var s,a=n("eKYsq");s=a.createRoot,a.hydrateRoot}),a("brsYM",function(t,r){e(t.exports,"LoginContext",()=>o),e(t.exports,"Authenticate",()=>l);var s=n("c54Ow"),a=n("lbJE2");let o=(0,a.createContext)(),l=e=>{let t=e.usernameSaveKey?`${document.location.pathname}#Authenticate${e.usernameSaveKey}`:void 0,r=t?localStorage.getItem(t):null,[n,l]=(0,a.useState)(void 0!==e.username?e.username:r),i=(0,a.useRef)(""),[c,u]=(0,a.useState)(""),[d,x]=(0,a.useState)(null),h=async()=>{try{u("");let e=await fetch("/login",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:i.current.value})});if(!e.ok){if(403===e.status)throw Error("ログイン・エラー");throw Error(`${e.status} ${e.statusText}`)}let r=await e.json();x(r),void 0!==t&&localStorage.setItem(t,n)}catch(e){u(e.message),x(null),void 0!==t&&localStorage.removeItem(t)}};return(0,a.useEffect)(()=>{if(void 0!==e.username&&void 0!==e.password)i.current.value=e.password,h();else if(void 0!==t){let e=localStorage.getItem(t);null!==e&&(i.current.value=e,l(e))}},[]),d?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"authenticate-logout",children:[(0,s.jsxs)("span",{children:["User: ",d?d.username:""]}),void 0!==e.username&&void 0!==e.password?null:(0,s.jsx)("button",{type:"button",onClick:()=>{x(null),void 0!==t&&localStorage.removeItem(t)},children:"ログアウト"})]}),(0,s.jsx)(o.Provider,{value:d,children:e.children})]}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"authenticate-login",children:[(0,s.jsxs)("label",{children:[(0,s.jsx)("span",{children:"ユーザ名:"}),(0,s.jsx)("span",{children:(0,s.jsx)("input",{type:"text",placeholder:"ユーザ名",onChange:e=>l(e.target.value),value:n})})]}),(0,s.jsxs)("label",{children:[(0,s.jsx)("span",{children:"パスワード:"}),(0,s.jsx)("span",{children:(0,s.jsx)("input",{type:"password",ref:i,placeholder:"パスワード",defaultValue:""})})]}),(0,s.jsx)("button",{type:"button",onClick:h,children:"ログイン"})]}),(0,s.jsx)("div",{children:""===c?null:(0,s.jsx)("div",{className:"error-message",onClick:()=>u(""),children:c})})]})}}),a("6Jdkr",function(t,r){e(t.exports,"TextChat",()=>c);var s=n("c54Ow"),a=n("lbJE2"),o=n("brsYM"),l=n("lHCVX"),i=n("lPoRS");let c=()=>{let e=(0,a.useContext)(o.LoginContext),t=e?e.username:"",r=(0,a.useContext)(l.SocketContext),n=r?r.current:null,[c,u]=(0,a.useState)(""),[d,x]=(0,a.useState)([]),h=(0,a.useRef)(null),[m,p]=(0,a.useState)("*"),[v,f]=(0,a.useState)([]),j=(0,a.useRef)(null),g=e=>{x(t=>[...t,e])},C=e=>{f(e),0>e.indexOf(m)&&p("*")},b=e=>{x(t=>t.map(t=>t.time===e.time&&t.from===e.from?{...t,reactions:[...t.reactions||[],e.reaction]}:t))},y=()=>{n&&(n.emit("text",{from:t,to:m,text:c,image:j.current.getImageDataURL(),time:Date.now()}),u(""))},D=(e,t)=>{n&&n.emit("reaction",{from:e.from,time:e.time,reaction:t})};return(0,a.useEffect)(()=>{if(n)return console.log("[TextChat] adding listeners"),n.on("text",g),n.on("user-list",C),n.on("reaction",b),n.emit("user-list",{from:t}),()=>{console.log("[TextChat] removing listeners"),n.off("text",g),n.off("user-list",C),n.off("reaction",b)}},[n,t,m]),(0,a.useEffect)(()=>{h.current&&h.current.scrollIntoView({block:"nearest"})},[d]),(0,s.jsxs)("div",{className:"text-chat",children:[(0,s.jsx)("div",{className:"text-chat-message-list-container",children:(0,s.jsxs)("div",{className:"text-chat-message-list",children:[d.map(e=>(0,s.jsxs)("div",{className:e.from===t?"text-chat-from-me":"text-chat-from-them",children:[(0,s.jsxs)("div",{className:"message-header",children:[e.from!==t&&(0,s.jsxs)("span",{children:[e.from," > "]}),(0,s.jsx)("span",{children:e.text})]}),e.image&&(0,s.jsx)("img",{src:e.image,alt:"paint",onClick:e=>j.current.putImageDataURL(e.target.src)}),(0,s.jsx)("div",{className:"reactions",children:e.reactions&&e.reactions.map((e,t)=>(0,s.jsx)("span",{className:"reaction",children:e},t))}),(0,s.jsxs)("div",{className:"reaction-buttons",children:[(0,s.jsx)("button",{onClick:()=>D(e,"\uD83D\uDC4D"),children:"\uD83D\uDC4D"}),(0,s.jsx)("button",{onClick:()=>D(e,"❤️"),children:"❤️"}),(0,s.jsx)("button",{onClick:()=>D(e,"\uD83D\uDE02"),children:"\uD83D\uDE02"})]})]},e.from+e.time)),(0,s.jsx)("div",{ref:h})]})}),(0,s.jsxs)("div",{className:"text-chat-input",children:[(0,s.jsxs)("select",{onChange:e=>{p(e.target.value)},value:m,children:[(0,s.jsx)("option",{value:"*",children:"*"}),v.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsx)("input",{type:"text",onChange:e=>{u(e.target.value)},value:c,onKeyUp:e=>{"Enter"===e.key&&c.length>0&&y()}}),(0,s.jsx)("button",{type:"button",onClick:y,disabled:null===n||""===c,children:"送信"})]}),(0,s.jsx)(i.Paint,{ref:j})]})}});var o=n("c54Ow"),l=n("dFw4U"),i=n("aFIWk"),c=n("brsYM"),u=n("lHCVX"),d=n("6Jdkr");(0,l.createRoot)(document.getElementById("root")).render((0,o.jsxs)(i.ErrorBoundary,{children:[(0,o.jsx)(c.Authenticate,{children:(0,o.jsx)(u.WithSocket,{nsp:"/chat",children:(0,o.jsx)(d.TextChat,{})})}),(0,o.jsx)("hr",{})]}));
//# sourceMappingURL=report02.4f9f48d7.js.map

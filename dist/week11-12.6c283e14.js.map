{"mappings":"A,S,E,C,C,C,C,C,C,C,E,O,c,C,E,E,C,I,E,I,E,W,C,E,a,C,C,E,C,I,E,W,E,C,E,E,C,E,E,E,iB,A,O,I,A,C,E,S,C,E,G,K,E,O,C,C,E,C,O,C,G,K,E,C,I,E,C,C,E,A,Q,C,C,E,C,I,E,C,G,E,Q,C,C,E,O,C,C,E,C,E,E,I,C,E,O,C,E,E,O,E,E,O,A,C,I,E,A,M,uB,E,I,O,E,I,C,mB,C,C,E,Q,C,S,C,C,C,E,C,C,E,C,C,E,E,iB,C,G,I,E,E,Q,C,E,Q,S,C,C,C,E,E,E,O,C,a,I,E,A,G,E,G,ICIE,E,E,E,SAAA,EAAqB,EAArB,UAAA,CACsB,EAAtB,WAAA,A,G,E,Q,S,C,C,C,E,E,E,O,C,e,I,G,E,E,O,C,e,I,GCYD,IAAA,EAAA,EAAA,S,E,E,SAMM,IAAM,EAAe,AAAA,CAAA,EAAA,EAAA,aAAY,AAAZ,IAEf,EAAe,AAAC,IAE3B,IAAM,EAAc,EAAM,eAAe,CACvC,CAAC,EAAE,SAAS,QAAQ,CAAC,QAAQ,CAAC,aAAa,EAAE,EAAM,eAAe,CAAC,CAAC,CAAG,KAAA,EAEnE,EAAgB,EAAc,aAAa,OAAO,CAAC,GAAe,KAGlE,CAAC,EAAe,EAAiB,CAAG,AAAA,CAAA,EAAA,EAAA,QAAO,AAAP,EAAS,AAAmB,KAAA,IAAnB,EAAM,QAAQ,CAC/D,EAAM,QAAQ,CAAG,GAGb,EAAmB,AAAA,CAAA,EAAA,EAAA,MAAK,AAAL,EAAO,IAG1B,CAAC,EAAc,EAAgB,CAAG,AAAA,CAAA,EAAA,EAAA,QAAO,AAAP,EAAS,IAG3C,CAAC,EAAM,EAAQ,CAAG,AAAA,CAAA,EAAA,EAAA,QAAO,AAAP,EAAS,MAG3B,EAAQ,UACZ,GAAI,CACF,EAAgB,IAChB,IAAM,EAAW,MAAM,MAAM,SAAU,CACrC,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,SAAS,CAAC,CAEnB,SAAU,EACV,SAAU,EAAiB,OAAO,CAAC,KAAK,AAC1C,EACF,GACA,GAAI,CAAC,EAAS,EAAE,CAAE,CAEhB,GAAI,AAAoB,MAApB,EAAS,MAAM,CAEjB,MAAM,AAAI,MAAM,WAGhB,OAAM,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","sources":["<anon>","node_modules/react-dom/client.js","src/js/Authenticate.jsx","src/js/TextChat.jsx","src/js/week11-12.jsx"],"sourcesContent":["\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\n\n      var $parcel$global = globalThis;\n    \nvar $parcel$modules = {};\nvar $parcel$inits = {};\n\nvar parcelRequire = $parcel$global[\"parcelRequire49ed\"];\n\nif (parcelRequire == null) {\n  parcelRequire = function(id) {\n    if (id in $parcel$modules) {\n      return $parcel$modules[id].exports;\n    }\n    if (id in $parcel$inits) {\n      var init = $parcel$inits[id];\n      delete $parcel$inits[id];\n      var module = {id: id, exports: {}};\n      $parcel$modules[id] = module;\n      init.call(module.exports, module, module.exports);\n      return module.exports;\n    }\n    var err = new Error(\"Cannot find module '\" + id + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n  };\n\n  parcelRequire.register = function register(id, init) {\n    $parcel$inits[id] = init;\n  };\n\n  $parcel$global[\"parcelRequire49ed\"] = parcelRequire;\n}\n\nvar parcelRegister = parcelRequire.register;\nparcelRegister(\"dFw4U\", function(module, exports) {\n\n$parcel$export(module.exports, \"createRoot\", () => $9f37fcc7ae75ef6e$export$882461b6382ed46c, (v) => $9f37fcc7ae75ef6e$export$882461b6382ed46c = v);\nvar $9f37fcc7ae75ef6e$export$882461b6382ed46c;\nvar $9f37fcc7ae75ef6e$export$757ceba2d55c277e;\n\"use strict\";\n\nvar $eKYsq = parcelRequire(\"eKYsq\");\nvar $9f37fcc7ae75ef6e$var$i;\n$9f37fcc7ae75ef6e$export$882461b6382ed46c = $eKYsq.createRoot;\n$9f37fcc7ae75ef6e$export$757ceba2d55c277e = $eKYsq.hydrateRoot;\n\n});\n\nparcelRegister(\"brsYM\", function(module, exports) {\n\n$parcel$export(module.exports, \"LoginContext\", () => $0cfbb9ccf2d9087e$export$a0806b2ebea0c4e);\n$parcel$export(module.exports, \"Authenticate\", () => $0cfbb9ccf2d9087e$export$3f934a281632646c);\n/**\r\n * 簡易ログイン機能\r\n * <Authenticate> ... </Authenticate>\r\n * \r\n * 未ログイン時: ログインの画面を表示する．\r\n * ログイン時：子要素を表示する．ならびにログオフボタンを上部に表示する．\r\n * \r\n * [自動ログインの実験的機能]\r\n * propsとして，username, passwordが渡されると，コンポーネントのマウント時に\r\n * 指定されたusernameとpasswordを使って自動的にログインを試みることにする．\r\n * ログアウトボタンは表示されない．\r\n * [開発支援用：localStorageにユーザ名を保存する機能]\r\n * propsに usernameSaveKey が指定されると，\r\n * usernameSaveKeyで指定された値をkeyとしてlocalStorageにユーザ名を保存する．\r\n * 保存されたユーザ名は，次回のマウント時に自動的に読み込まれ，ユーザ名に設定される．\r\n * その際には便宜的にpasswordはusernameと同じものに設定される．\r\n * ユーザはログインボタンをクリックすればログインされることになる．\r\n */ \nvar $c54Ow = parcelRequire(\"c54Ow\");\n\n\nvar $lbJE2 = parcelRequire(\"lbJE2\");\nconst $0cfbb9ccf2d9087e$export$a0806b2ebea0c4e = /*#__PURE__*/ (0, $lbJE2.createContext)();\nconst $0cfbb9ccf2d9087e$export$3f934a281632646c = (props)=>{\n    // localStorageに保存するユーザ名のキー\n    const usernameKey = props.usernameSaveKey ? `${document.location.pathname}#Authenticate${props.usernameSaveKey}` : undefined;\n    // localStorageからユーザ名を取得する．無ければ値をnullにする．\n    const savedUsername = usernameKey ? localStorage.getItem(usernameKey) : null;\n    // ユーザ名の入力\n    const [usernameInput, setUsernameInput] = (0, $lbJE2.useState)(props.username !== undefined ? props.username : savedUsername);\n    // passwordの入力 useRefを使って，値を取得する．\n    const passwordInputRef = (0, $lbJE2.useRef)(\"\");\n    // /loginにPOSTリクエストを送った際のエラーメッセージを表示する．\n    const [errorMessage, setErrorMessage] = (0, $lbJE2.useState)(\"\");\n    // ユーザ情報（usernameとtoken）を保持する．\n    const [user, setUser] = (0, $lbJE2.useState)(null);\n    // ログイン：loginのAPIを呼ぶ．\n    const login = async ()=>{\n        try {\n            setErrorMessage(\"\");\n            const response = await fetch(\"/login\", {\n                method: \"post\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    // username と password を渡す．\n                    username: usernameInput,\n                    password: passwordInputRef.current.value\n                })\n            });\n            if (!response.ok) {\n                // statusが200番台以外の時はエラーとして扱う．\n                if (response.status === 403) // Forbiddenエラーであれば，ログインエラーとして扱う．\n                throw new Error(\"\\u30ED\\u30B0\\u30A4\\u30F3\\u30FB\\u30A8\\u30E9\\u30FC\");\n                else // それ以外であれば，statusコードとstatusテキストをエラーとして表示することにする．\n                throw new Error(`${response.status} ${response.statusText}`);\n            }\n            // ユーザ情報（usernameとtoken）がJSONレスポンスとして返ってくるので，これをuserに保存する．\n            const data = await response.json();\n            setUser(data);\n            // ユーザ名をlocalStorageに保存する．\n            if (usernameKey !== undefined) localStorage.setItem(usernameKey, usernameInput);\n        } catch (error) {\n            setErrorMessage(error.message);\n            // エラーの場合は，ユーザ情報を削除することにする．\n            setUser(null);\n            if (usernameKey !== undefined) localStorage.removeItem(usernameKey);\n        }\n    };\n    // ログアウト：ユーザ情報を削除する．\n    const logout = ()=>{\n        setUser(null);\n        if (usernameKey !== undefined) localStorage.removeItem(usernameKey);\n    };\n    // 実験的な自動ログイン機能\n    (0, $lbJE2.useEffect)(()=>{\n        // usernameとpasswordがpropsに指定されている時には自動ログインを行うことにする．\n        if (props.username !== undefined && props.password !== undefined) {\n            // passwordを設定する．\n            passwordInputRef.current.value = props.password;\n            // ログインを試みる．\n            login();\n        } else if (usernameKey !== undefined) {\n            // ユーザ名をlocalStorageから取得する．\n            const username = localStorage.getItem(usernameKey);\n            if (username !== null) {\n                // 便宜的にpasswordをusernameと同じものに設定する．\n                passwordInputRef.current.value = username;\n                // ユーザ名を設定する．\n                setUsernameInput(username);\n            // 自動的にログインする場合は，loginを呼ぶ．\n            // login();\n            }\n        }\n    }, []);\n    return user ? /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n        children: [\n            /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n                className: \"authenticate-logout\",\n                children: [\n                    /*#__PURE__*/ (0, $c54Ow.jsxs)(\"span\", {\n                        children: [\n                            \"User: \",\n                            user ? user.username : \"\"\n                        ]\n                    }),\n                    props.username !== undefined && props.password !== undefined ? null : /*#__PURE__*/ (0, $c54Ow.jsx)(\"button\", {\n                        type: \"button\",\n                        onClick: logout,\n                        children: \"\\u30ED\\u30B0\\u30A2\\u30A6\\u30C8\"\n                    })\n                ]\n            }),\n            /*#__PURE__*/ (0, $c54Ow.jsx)($0cfbb9ccf2d9087e$export$a0806b2ebea0c4e.Provider, {\n                value: user,\n                children: props.children\n            })\n        ]\n    }) : /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n        children: [\n            /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n                className: \"authenticate-login\",\n                children: [\n                    /*#__PURE__*/ (0, $c54Ow.jsxs)(\"label\", {\n                        children: [\n                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"span\", {\n                                children: \"\\u30E6\\u30FC\\u30B6\\u540D:\"\n                            }),\n                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"span\", {\n                                children: /*#__PURE__*/ (0, $c54Ow.jsx)(\"input\", {\n                                    type: \"text\",\n                                    placeholder: \"\\u30E6\\u30FC\\u30B6\\u540D\",\n                                    onChange: (event)=>setUsernameInput(event.target.value),\n                                    value: usernameInput\n                                })\n                            })\n                        ]\n                    }),\n                    /*#__PURE__*/ (0, $c54Ow.jsxs)(\"label\", {\n                        children: [\n                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"span\", {\n                                children: \"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9:\"\n                            }),\n                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"span\", {\n                                children: /*#__PURE__*/ (0, $c54Ow.jsx)(\"input\", {\n                                    type: \"password\",\n                                    ref: passwordInputRef,\n                                    placeholder: \"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\",\n                                    defaultValue: \"\"\n                                })\n                            })\n                        ]\n                    }),\n                    /*#__PURE__*/ (0, $c54Ow.jsx)(\"button\", {\n                        type: \"button\",\n                        onClick: login,\n                        children: \"\\u30ED\\u30B0\\u30A4\\u30F3\"\n                    })\n                ]\n            }),\n            /*#__PURE__*/ (0, $c54Ow.jsx)(\"div\", {\n                children: errorMessage === \"\" ? null : /*#__PURE__*/ (0, $c54Ow.jsx)(\"div\", {\n                    className: \"error-message\",\n                    onClick: ()=>setErrorMessage(\"\"),\n                    children: errorMessage\n                })\n            })\n        ]\n    });\n};\n\n});\n\nparcelRegister(\"6Jdkr\", function(module, exports) {\n\n$parcel$export(module.exports, \"TextChat\", () => $15a317c7617f5e34$export$d43a277f87371557);\n\nvar $c54Ow = parcelRequire(\"c54Ow\");\n\nvar $lbJE2 = parcelRequire(\"lbJE2\");\n\nvar $brsYM = parcelRequire(\"brsYM\");\n\nvar $lHCVX = parcelRequire(\"lHCVX\");\n\nvar $lPoRS = parcelRequire(\"lPoRS\");\n\nconst $15a317c7617f5e34$export$d43a277f87371557 = ()=>{\n    const user = (0, $lbJE2.useContext)((0, $brsYM.LoginContext));\n    const username = user ? user.username : \"\";\n    const socketRef = (0, $lbJE2.useContext)((0, $lHCVX.SocketContext));\n    const socket = socketRef ? socketRef.current : null;\n    const [inputMessage, setInputMessage] = (0, $lbJE2.useState)(\"\");\n    const [messages, setMessages] = (0, $lbJE2.useState)([]);\n    const lastLineRef = (0, $lbJE2.useRef)(null);\n    const [chatTo, setChatTo] = (0, $lbJE2.useState)(\"*\");\n    const [userList, setUserList] = (0, $lbJE2.useState)([]);\n    const paintRef = (0, $lbJE2.useRef)(null);\n    const [hoveredMessage, setHoveredMessage] = (0, $lbJE2.useState)(null);\n    const handleTextMessage = (data)=>{\n        setMessages((prevMessages)=>[\n                ...prevMessages,\n                data\n            ]);\n    };\n    const handleUserList = (data)=>{\n        setUserList(data);\n        if (data.indexOf(chatTo) < 0) setChatTo(\"*\");\n    };\n    const handleReaction = (data)=>{\n        setMessages((prevMessages)=>prevMessages.map((msg)=>msg.time === data.time && msg.from === data.from ? {\n                    ...msg,\n                    reactions: [\n                        ...msg.reactions || [],\n                        data.reaction\n                    ]\n                } : msg));\n    };\n    const sendTextMessage = ()=>{\n        if (socket) {\n            socket.emit(\"text\", {\n                from: username,\n                to: chatTo,\n                text: inputMessage,\n                image: paintRef.current.getImageDataURL(),\n                time: Date.now()\n            });\n            setInputMessage(\"\");\n        }\n    };\n    const sendReaction = (message, reaction)=>{\n        if (socket) socket.emit(\"reaction\", {\n            from: message.from,\n            time: message.time,\n            reaction: reaction\n        });\n    };\n    const inputChanged = (event)=>{\n        setInputMessage(event.target.value);\n    };\n    const handleKeyUp = (event)=>{\n        if (event.key === \"Enter\" && inputMessage.length > 0) sendTextMessage();\n    };\n    const selectChatTo = (event)=>{\n        setChatTo(event.target.value);\n    };\n    (0, $lbJE2.useEffect)(()=>{\n        if (socket) {\n            console.log(\"[TextChat] adding listeners\");\n            socket.on(\"text\", handleTextMessage);\n            socket.on(\"user-list\", handleUserList);\n            socket.on(\"reaction\", handleReaction);\n            socket.emit(\"user-list\", {\n                from: username\n            });\n            return ()=>{\n                console.log(\"[TextChat] removing listeners\");\n                socket.off(\"text\", handleTextMessage);\n                socket.off(\"user-list\", handleUserList);\n                socket.off(\"reaction\", handleReaction);\n            };\n        }\n    }, [\n        socket,\n        username,\n        chatTo\n    ]);\n    (0, $lbJE2.useEffect)(()=>{\n        if (lastLineRef.current) lastLineRef.current.scrollIntoView({\n            block: \"nearest\"\n        });\n    }, [\n        messages\n    ]);\n    return /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n        className: \"text-chat\",\n        children: [\n            /*#__PURE__*/ (0, $c54Ow.jsx)(\"div\", {\n                className: \"text-chat-message-list-container\",\n                children: /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n                    className: \"text-chat-message-list\",\n                    children: [\n                        messages.map((message)=>/*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n                                className: message.from === username ? \"text-chat-from-me text-chat-message\" : \"text-chat-from-them text-chat-message\",\n                                onMouseEnter: ()=>setHoveredMessage(message),\n                                onMouseLeave: ()=>setHoveredMessage(null),\n                                children: [\n                                    /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n                                        className: \"message-header\",\n                                        children: [\n                                            message.from !== username && /*#__PURE__*/ (0, $c54Ow.jsxs)(\"span\", {\n                                                children: [\n                                                    message.from,\n                                                    \" > \"\n                                                ]\n                                            }),\n                                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"span\", {\n                                                children: message.text\n                                            })\n                                        ]\n                                    }),\n                                    message.image && /*#__PURE__*/ (0, $c54Ow.jsx)(\"img\", {\n                                        src: message.image,\n                                        alt: \"paint\",\n                                        onClick: (event)=>paintRef.current.putImageDataURL(event.target.src)\n                                    }),\n                                    /*#__PURE__*/ (0, $c54Ow.jsx)(\"div\", {\n                                        className: \"reactions\",\n                                        children: message.reactions && message.reactions.map((reaction, index)=>/*#__PURE__*/ (0, $c54Ow.jsx)(\"span\", {\n                                                className: \"reaction-mark\",\n                                                children: reaction\n                                            }, index))\n                                    }),\n                                    hoveredMessage === message && /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n                                        className: \"reaction-buttons\",\n                                        children: [\n                                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"button\", {\n                                                onClick: ()=>sendReaction(message, \"\\uD83D\\uDC4D\"),\n                                                children: \"\\uD83D\\uDC4D\"\n                                            }),\n                                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"button\", {\n                                                onClick: ()=>sendReaction(message, \"\\u2764\\uFE0F\"),\n                                                children: \"\\u2764\\uFE0F\"\n                                            }),\n                                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"button\", {\n                                                onClick: ()=>sendReaction(message, \"\\uD83D\\uDE02\"),\n                                                children: \"\\uD83D\\uDE02\"\n                                            })\n                                        ]\n                                    })\n                                ]\n                            }, message.from + message.time)),\n                        /*#__PURE__*/ (0, $c54Ow.jsx)(\"div\", {\n                            ref: lastLineRef\n                        })\n                    ]\n                })\n            }),\n            /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n                className: \"text-chat-input\",\n                children: [\n                    /*#__PURE__*/ (0, $c54Ow.jsxs)(\"select\", {\n                        onChange: selectChatTo,\n                        value: chatTo,\n                        children: [\n                            /*#__PURE__*/ (0, $c54Ow.jsx)(\"option\", {\n                                value: \"*\",\n                                children: \"*\"\n                            }),\n                            userList.map((u)=>/*#__PURE__*/ (0, $c54Ow.jsx)(\"option\", {\n                                    value: u,\n                                    children: u\n                                }, u))\n                        ]\n                    }),\n                    /*#__PURE__*/ (0, $c54Ow.jsx)(\"input\", {\n                        type: \"text\",\n                        onChange: inputChanged,\n                        value: inputMessage,\n                        onKeyUp: handleKeyUp\n                    }),\n                    /*#__PURE__*/ (0, $c54Ow.jsx)(\"button\", {\n                        type: \"button\",\n                        onClick: sendTextMessage,\n                        disabled: socket === null || inputMessage === \"\",\n                        children: \"\\u9001\\u4FE1\"\n                    })\n                ]\n            }),\n            /*#__PURE__*/ (0, $c54Ow.jsx)((0, $lPoRS.Paint), {\n                ref: paintRef\n            })\n        ]\n    });\n};\n\n});\n\n/**\r\n * 第１１－１２週ミニ課題用のJSXファイル\r\n * テキストチャットを実装する．\r\n */ // React DOMの関数をimportする．\n\nvar $c54Ow = parcelRequire(\"c54Ow\");\n\nvar $dFw4U = parcelRequire(\"dFw4U\");\n\nvar $aFIWk = parcelRequire(\"aFIWk\");\n\nvar $brsYM = parcelRequire(\"brsYM\");\n\nvar $lHCVX = parcelRequire(\"lHCVX\");\n\nvar $6Jdkr = parcelRequire(\"6Jdkr\");\n/* ここまで */ // ReactコンポーネントをidがrootであるDOM要素に配置する．\nconst $c1eceed7a63b2e55$var$root = (0, $dFw4U.createRoot)(document.getElementById(\"root\"));\n$c1eceed7a63b2e55$var$root.render(/*#__PURE__*/ (0, $c54Ow.jsx)((0, $aFIWk.ErrorBoundary), {\n    children: /*#__PURE__*/ (0, $c54Ow.jsxs)(\"div\", {\n        className: \"cols-wrap two-cols\",\n        children: [\n            /*#__PURE__*/ (0, $c54Ow.jsx)((0, $brsYM.Authenticate), {\n                children: /*#__PURE__*/ (0, $c54Ow.jsx)((0, $lHCVX.WithSocket), {\n                    nsp: \"/chat\",\n                    children: /*#__PURE__*/ (0, $c54Ow.jsx)((0, $6Jdkr.TextChat), {})\n                })\n            }),\n            /*#__PURE__*/ (0, $c54Ow.jsx)((0, $brsYM.Authenticate), {\n                children: /*#__PURE__*/ (0, $c54Ow.jsx)((0, $lHCVX.WithSocket), {\n                    nsp: \"/chat\",\n                    children: /*#__PURE__*/ (0, $c54Ow.jsx)((0, $6Jdkr.TextChat), {})\n                })\n            })\n        ]\n    })\n}));\n\n\n//# sourceMappingURL=week11-12.6c283e14.js.map\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\r\n * 簡易ログイン機能\r\n * <Authenticate> ... </Authenticate>\r\n * \r\n * 未ログイン時: ログインの画面を表示する．\r\n * ログイン時：子要素を表示する．ならびにログオフボタンを上部に表示する．\r\n * \r\n * [自動ログインの実験的機能]\r\n * propsとして，username, passwordが渡されると，コンポーネントのマウント時に\r\n * 指定されたusernameとpasswordを使って自動的にログインを試みることにする．\r\n * ログアウトボタンは表示されない．\r\n * [開発支援用：localStorageにユーザ名を保存する機能]\r\n * propsに usernameSaveKey が指定されると，\r\n * usernameSaveKeyで指定された値をkeyとしてlocalStorageにユーザ名を保存する．\r\n * 保存されたユーザ名は，次回のマウント時に自動的に読み込まれ，ユーザ名に設定される．\r\n * その際には便宜的にpasswordはusernameと同じものに設定される．\r\n * ユーザはログインボタンをクリックすればログインされることになる．\r\n */\r\nimport '../css/Authenticate.css';\r\n\r\nimport { useState, useRef, createContext, useEffect } from 'react';\r\n\r\n// ユーザ情報を子要素に渡すために context を使用する．\r\nexport const LoginContext = createContext();\r\n\r\nexport const Authenticate = (props) => {\r\n  // localStorageに保存するユーザ名のキー\r\n  const usernameKey = props.usernameSaveKey ?\r\n    `${document.location.pathname}#Authenticate${props.usernameSaveKey}` : undefined;\r\n  // localStorageからユーザ名を取得する．無ければ値をnullにする．\r\n  const savedUsername = usernameKey ? localStorage.getItem(usernameKey) : null;\r\n\r\n  // ユーザ名の入力\r\n  const [usernameInput, setUsernameInput] = useState(props.username !== undefined ?\r\n    props.username : savedUsername);\r\n\r\n  // passwordの入力 useRefを使って，値を取得する．\r\n  const passwordInputRef = useRef('');\r\n\r\n  // /loginにPOSTリクエストを送った際のエラーメッセージを表示する．\r\n  const [errorMessage, setErrorMessage] = useState('');\r\n\r\n  // ユーザ情報（usernameとtoken）を保持する．\r\n  const [user, setUser] = useState(null);\r\n\r\n  // ログイン：loginのAPIを呼ぶ．\r\n  const login = async () => {\r\n    try {\r\n      setErrorMessage('');\r\n      const response = await fetch('/login', {\r\n        method: 'post',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          // username と password を渡す．\r\n          username: usernameInput,\r\n          password: passwordInputRef.current.value\r\n        })\r\n      });\r\n      if (!response.ok) {\r\n        // statusが200番台以外の時はエラーとして扱う．\r\n        if (response.status === 403) {\r\n          // Forbiddenエラーであれば，ログインエラーとして扱う．\r\n          throw new Error('ログイン・エラー');\r\n        } else {\r\n          // それ以外であれば，statusコードとstatusテキストをエラーとして表示することにする．\r\n          throw new Error(`${response.status} ${response.statusText}`);\r\n        }\r\n      }\r\n      // ユーザ情報（usernameとtoken）がJSONレスポンスとして返ってくるので，これをuserに保存する．\r\n      const data = await response.json();\r\n      setUser(data);\r\n      // ユーザ名をlocalStorageに保存する．\r\n      if (usernameKey !== undefined) {\r\n        localStorage.setItem(usernameKey, usernameInput);\r\n      }\r\n    } catch (error) {\r\n      setErrorMessage(error.message);\r\n      // エラーの場合は，ユーザ情報を削除することにする．\r\n      setUser(null);\r\n      if (usernameKey !== undefined) {\r\n        localStorage.removeItem(usernameKey);\r\n      }\r\n    }\r\n  };\r\n\r\n  // ログアウト：ユーザ情報を削除する．\r\n  const logout = () => {\r\n    setUser(null);\r\n    if (usernameKey !== undefined) {\r\n      localStorage.removeItem(usernameKey);\r\n    }\r\n  };\r\n\r\n  // 実験的な自動ログイン機能\r\n  useEffect(() => {\r\n    // usernameとpasswordがpropsに指定されている時には自動ログインを行うことにする．\r\n    if (props.username !== undefined && props.password !== undefined) {\r\n      // passwordを設定する．\r\n      passwordInputRef.current.value = props.password;\r\n      // ログインを試みる．\r\n      login();\r\n    } else if (usernameKey !== undefined) {\r\n      // ユーザ名をlocalStorageから取得する．\r\n      const username = localStorage.getItem(usernameKey);\r\n      if (username !== null) {\r\n        // 便宜的にpasswordをusernameと同じものに設定する．\r\n        passwordInputRef.current.value = username;\r\n        // ユーザ名を設定する．\r\n        setUsernameInput(username);\r\n        // 自動的にログインする場合は，loginを呼ぶ．\r\n        // login();\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  return (user ?\r\n    <div>\r\n      {/* ログインしている場合 */}\r\n      <div className=\"authenticate-logout\">\r\n        <span>User: {user ? user.username : ''}</span>\r\n        {/* 自動ログインの場合はログアウトボタンを表示しないことにする． */}\r\n        {(props.username !== undefined && props.password !== undefined) ? null :\r\n          <button type=\"button\" onClick={logout}>ログアウト</button>}\r\n      </div>\r\n      <LoginContext.Provider value={user}>\r\n        {/* userをLoginContextに渡すとともに，子要素を表示する． */}\r\n        {props.children}\r\n      </LoginContext.Provider>\r\n    </div>\r\n    :\r\n    <div>\r\n      {/* 未ログインの場合 */}\r\n      <div className=\"authenticate-login\">\r\n        <label>\r\n          <span>ユーザ名:</span>\r\n          <span><input type=\"text\" placeholder=\"ユーザ名\"\r\n            onChange={(event) => setUsernameInput(event.target.value)} value={usernameInput} />\r\n          </span>\r\n        </label>\r\n        <label>\r\n          <span>パスワード:</span>\r\n          <span><input type=\"password\" ref={passwordInputRef}\r\n            placeholder=\"パスワード\" defaultValue='' />\r\n          </span>\r\n        </label>\r\n        <button type=\"button\" onClick={login}>ログイン</button>\r\n      </div>\r\n      <div>\r\n        {errorMessage === '' ? null :\r\n          <div className=\"error-message\" onClick={() => setErrorMessage('')}>\r\n            {errorMessage}</div>}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n","import React, { useState, useEffect, useContext, useRef } from 'react';\r\nimport { LoginContext } from './Authenticate';\r\nimport { SocketContext } from './WithSocket';\r\nimport { Paint } from './Paint';\r\nimport '../css/TextChat.css';\r\n\r\nexport const TextChat = () => {\r\n  const user = useContext(LoginContext);\r\n  const username = user ? user.username : '';\r\n  const socketRef = useContext(SocketContext);\r\n  const socket = socketRef ? socketRef.current : null;\r\n  const [inputMessage, setInputMessage] = useState('');\r\n  const [messages, setMessages] = useState([]);\r\n  const lastLineRef = useRef(null);\r\n  const [chatTo, setChatTo] = useState('*');\r\n  const [userList, setUserList] = useState([]);\r\n  const paintRef = useRef(null);\r\n  const [hoveredMessage, setHoveredMessage] = useState(null);\r\n\r\n  const handleTextMessage = (data) => {\r\n    setMessages((prevMessages) => [...prevMessages, data]);\r\n  };\r\n\r\n  const handleUserList = (data) => {\r\n    setUserList(data);\r\n    if (data.indexOf(chatTo) < 0) {\r\n      setChatTo('*');\r\n    }\r\n  };\r\n\r\n  const handleReaction = (data) => {\r\n    setMessages((prevMessages) =>\r\n      prevMessages.map((msg) =>\r\n        msg.time === data.time && msg.from === data.from\r\n          ? { ...msg, reactions: [...(msg.reactions || []), data.reaction] }\r\n          : msg\r\n      )\r\n    );\r\n  };\r\n\r\n  const sendTextMessage = () => {\r\n    if (socket) {\r\n      socket.emit('text', {\r\n        from: username,\r\n        to: chatTo,\r\n        text: inputMessage,\r\n        image: paintRef.current.getImageDataURL(),\r\n        time: Date.now(),\r\n      });\r\n      setInputMessage('');\r\n    }\r\n  };\r\n\r\n  const sendReaction = (message, reaction) => {\r\n    if (socket) {\r\n      socket.emit('reaction', {\r\n        from: message.from,\r\n        time: message.time,\r\n        reaction,\r\n      });\r\n    }\r\n  };\r\n\r\n  const inputChanged = (event) => {\r\n    setInputMessage(event.target.value);\r\n  };\r\n\r\n  const handleKeyUp = (event) => {\r\n    if (event.key === 'Enter' && inputMessage.length > 0) {\r\n      sendTextMessage();\r\n    }\r\n  };\r\n\r\n  const selectChatTo = (event) => {\r\n    setChatTo(event.target.value);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (socket) {\r\n      console.log('[TextChat] adding listeners');\r\n      socket.on('text', handleTextMessage);\r\n      socket.on('user-list', handleUserList);\r\n      socket.on('reaction', handleReaction);\r\n      socket.emit('user-list', { from: username });\r\n      return () => {\r\n        console.log('[TextChat] removing listeners');\r\n        socket.off('text', handleTextMessage);\r\n        socket.off('user-list', handleUserList);\r\n        socket.off('reaction', handleReaction);\r\n      };\r\n    }\r\n  }, [socket, username, chatTo]);\r\n\r\n  useEffect(() => {\r\n    if (lastLineRef.current) {\r\n      lastLineRef.current.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }, [messages]);\r\n\r\n  return (\r\n    <div className=\"text-chat\">\r\n      <div className=\"text-chat-message-list-container\">\r\n        <div className=\"text-chat-message-list\">\r\n          {messages.map((message) => (\r\n            <div\r\n              key={message.from + message.time}\r\n              className={\r\n                message.from === username\r\n                  ? 'text-chat-from-me text-chat-message'\r\n                  : 'text-chat-from-them text-chat-message'\r\n              }\r\n              onMouseEnter={() => setHoveredMessage(message)}\r\n              onMouseLeave={() => setHoveredMessage(null)}\r\n            >\r\n              <div className=\"message-header\">\r\n                {message.from !== username && <span>{message.from} &gt; </span>}\r\n                <span>{message.text}</span>\r\n              </div>\r\n              {message.image && (\r\n                <img\r\n                  src={message.image}\r\n                  alt=\"paint\"\r\n                  onClick={(event) =>\r\n                    paintRef.current.putImageDataURL(event.target.src)\r\n                  }\r\n                />\r\n              )}\r\n              <div className=\"reactions\">\r\n                {message.reactions &&\r\n                  message.reactions.map((reaction, index) => (\r\n                    <span key={index} className=\"reaction-mark\">\r\n                      {reaction}\r\n                    </span>\r\n                  ))}\r\n              </div>\r\n              {hoveredMessage === message && (\r\n                <div className=\"reaction-buttons\">\r\n                  <button onClick={() => sendReaction(message, '👍')}>👍</button>\r\n                  <button onClick={() => sendReaction(message, '❤️')}>❤️</button>\r\n                  <button onClick={() => sendReaction(message, '😂')}>😂</button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))}\r\n          <div ref={lastLineRef}></div>\r\n        </div>\r\n      </div>\r\n      <div className=\"text-chat-input\">\r\n        <select onChange={selectChatTo} value={chatTo}>\r\n          <option value=\"*\">*</option>\r\n          {userList.map((u) => (\r\n            <option key={u} value={u}>\r\n              {u}\r\n            </option>\r\n          ))}\r\n        </select>\r\n        <input\r\n          type=\"text\"\r\n          onChange={inputChanged}\r\n          value={inputMessage}\r\n          onKeyUp={handleKeyUp}\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          onClick={sendTextMessage}\r\n          disabled={socket === null || inputMessage === ''}\r\n        >\r\n          送信\r\n        </button>\r\n      </div>\r\n      <Paint ref={paintRef} />\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n\r\n","/**\r\n * 第１１－１２週ミニ課題用のJSXファイル\r\n * テキストチャットを実装する．\r\n */\r\n// React DOMの関数をimportする．\r\nimport { createRoot } from 'react-dom/client';\r\n\r\n// デバッグ用にエラー発生時にエラーメッセージを表示するコンポーネントで囲む．\r\nimport { ErrorBoundary } from './ErrorBoundary';\r\n\r\n// コンポーネントの定義をimportする．\r\nimport { Authenticate } from './Authenticate';\r\nimport { WithSocket } from './WithSocket';\r\n/* ここから */\r\nimport { TextChat } from './TextChat';\r\n/* ここまで */\r\n\r\n// ReactコンポーネントをidがrootであるDOM要素に配置する．\r\nconst root = createRoot(document.getElementById('root'));\r\nroot.render(\r\n  <ErrorBoundary>\r\n    <div className=\"cols-wrap two-cols\">\r\n      <Authenticate>\r\n        <WithSocket nsp=\"/chat\">\r\n          <TextChat />\r\n        </WithSocket>\r\n      </Authenticate>\r\n      <Authenticate>\r\n        <WithSocket nsp=\"/chat\">\r\n          <TextChat />\r\n        </WithSocket>\r\n      </Authenticate>\r\n    </div>\r\n  </ErrorBoundary>\r\n);"],"names":["$parcel$export","e","n","v","s","Object","defineProperty","get","set","enumerable","configurable","$parcel$global","globalThis","$parcel$modules","$parcel$inits","parcelRequire","id","exports","init","module","call","err","Error","code","register","parcelRegister","$9f37fcc7ae75ef6e$export$882461b6382ed46c","$eKYsq","createRoot","hydrateRoot","$0cfbb9ccf2d9087e$export$a0806b2ebea0c4e","$0cfbb9ccf2d9087e$export$3f934a281632646c","$c54Ow","$lbJE2","createContext","props","usernameKey","usernameSaveKey","document","location","pathname","undefined","savedUsername","localStorage","getItem","usernameInput","setUsernameInput","useState","username","passwordInputRef","useRef","errorMessage","setErrorMessage","user","setUser","login","response","fetch","method","headers","body","JSON","stringify","password","current","value","ok","status","statusText","data","json","setItem","error","message","removeItem","useEffect","jsxs","children","className","jsx","type","onClick","Provider","placeholder","onChange","event","target","ref","defaultValue","$15a317c7617f5e34$export$d43a277f87371557","$brsYM","$lHCVX","$lPoRS","useContext","LoginContext","socketRef","SocketContext","socket","inputMessage","setInputMessage","messages","setMessages","lastLineRef","chatTo","setChatTo","userList","setUserList","paintRef","hoveredMessage","setHoveredMessage","handleTextMessage","prevMessages","handleUserList","indexOf","handleReaction","map","msg","time","from","reactions","reaction","sendTextMessage","emit","to","text","image","getImageDataURL","Date","now","sendReaction","console","log","on","off","scrollIntoView","block","onMouseEnter","onMouseLeave","src","alt","putImageDataURL","index","u","onKeyUp","key","length","disabled","Paint","$dFw4U","$aFIWk","$6Jdkr","$c1eceed7a63b2e55$var$root","getElementById","render","ErrorBoundary","Authenticate","WithSocket","nsp","TextChat"],"version":3,"file":"week11-12.6c283e14.js.map"}